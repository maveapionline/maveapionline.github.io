(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Chat"],{"02aa":function(e,t,o){e.exports=o.p+"static/img/redPacket.349b489d.svg"},"5a96":function(e,t,o){"use strict";o.r(t);o("fb6a"),o("b0c0"),o("498a");var n=o("7a23"),i=o("02aa"),s=o.n(i),r=function(e){return Object(n["pushScopeId"])("data-v-08d40136"),e=e(),Object(n["popScopeId"])(),e},c={class:"chat-container"},a={class:"right"},l={class:"chat-name"},u={key:0,class:"icon-svg icon-renzheng",style:{"margin-left":"0.1rem"},"aria-hidden":"true"},d=r((function(){return Object(n["createElementVNode"])("use",{"xlink:href":"#icon-renzheng"},null,-1)})),h=[d],g={class:"chat-dec"},p=r((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-set"},null,-1)})),m=r((function(){return Object(n["createElementVNode"])("li",{class:"scroll-bottom"},null,-1)})),f={class:"van-safe-area-bottom van-hairline--top chat-bottom"},b={class:"reply-container van-hairline--bottom"},v=r((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-reply"},null,-1)})),O={class:"reply-content"},j={class:"top"},y={class:"bottom van-ellipsis"},k={class:"chat-bottom-textarea"},M={key:0,class:"group-b"},$={key:1,class:"group-b"},C={key:2,class:"group-b"},_={key:3,class:"group-b"},w={key:4,class:"group-b"},I={key:5,style:{display:"flex",flex:"1"}},V=r((function(){return Object(n["createElementVNode"])("use",{"xlink:href":"#icon-send"},null,-1)})),N=[V],T={class:"item"},E=r((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-redpacket"},null,-1)})),B={class:"block"},S={key:0,class:"item"},x={for:"uploaderFile-1"},L=r((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-camera"},null,-1)})),G={class:"block"},D={key:1,class:"item"},H=r((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-camera"},null,-1)})),P={class:"block"},F={style:{"text-align":"center","margin-top":"20px"}},R=r((function(){return Object(n["createElementVNode"])("img",{src:s.a,alt:""},null,-1)})),U=r((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-lightning"},null,-1)}));function A(e,t,i,s,r,d){var V,A,z,J,Y,W,q,K,Q,X,Z,ee,te,oe,ne,ie,se,re,ce,ae,le=this,ue=Object(n["resolveComponent"])("van-image"),de=Object(n["resolveComponent"])("van-nav-bar"),he=Object(n["resolveComponent"])("chat-notice"),ge=Object(n["resolveComponent"])("ChatItem"),pe=Object(n["resolveComponent"])("van-list"),me=Object(n["resolveComponent"])("van-icon"),fe=Object(n["resolveComponent"])("van-field"),be=Object(n["resolveComponent"])("van-button"),ve=Object(n["resolveComponent"])("van-count-down"),Oe=Object(n["resolveComponent"])("van-col"),je=Object(n["resolveComponent"])("van-row"),ye=Object(n["resolveComponent"])("van-loading"),ke=Object(n["resolveComponent"])("van-dialog"),Me=Object(n["resolveComponent"])("van-badge"),$e=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createElementVNode"])("section",c,[Object(n["createVNode"])(de,{"left-text":"","left-arrow":"",onClickLeft:d.back,fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2",onClickRight:t[1]||(t[1]=function(t){return e.$router.push({name:"ChatSet",params:{id:d.groupId}})})},{title:Object(n["withCtx"])((function(){var i,s,r,c;return[Object(n["createElementVNode"])("div",{class:"chat-title",onClick:t[0]||(t[0]=Object(n["withModifiers"])((function(t){return e.$router.push({name:"ChatSet",params:{id:d.groupId}})}),["stop"]))},[(Object(n["openBlock"])(),Object(n["createBlock"])(ue,{key:d.groupInfo.id,round:"",width:"0.5rem",height:"0.5rem","icon-size":"0.5rem","lazy-load":"","show-loading":"",src:(null===(i=d.groupInfo)||void 0===i?void 0:i.image)||e.$f.formatIcon(d.groupId),"error-icon":o("aecc")},null,8,["src","error-icon"])),Object(n["createElementVNode"])("div",a,[Object(n["createElementVNode"])("div",l,[Object(n["createTextVNode"])(Object(n["toDisplayString"])((null===(s=d.groupInfo)||void 0===s?void 0:s.nickname)||"")+" ",1),null!==(r=d.groupInfo)&&void 0!==r&&r.provider_count&&(null===(c=d.groupInfo)||void 0===c?void 0:c.provider_count)>0?(Object(n["openBlock"])(),Object(n["createElementBlock"])("svg",u,h)):Object(n["createCommentVNode"])("",!0)]),Object(n["createElementVNode"])("div",g,Object(n["toDisplayString"])(d.total)+" "+Object(n["toDisplayString"])(e.$t("members")),1)])])]})),right:Object(n["withCtx"])((function(){return[p]})),_:1},8,["onClickLeft"]),Object(n["createVNode"])(he,{content:r.activePinMsg.content},null,8,["content"]),Object(n["createVNode"])(pe,{loading:r.loading,"onUpdate:loading":t[3]||(t[3]=function(e){return r.loading=e}),finished:r.finished,error:r.error,"onUpdate:error":t[4]||(t[4]=function(e){return r.error=e}),offset:"200","error-text":e.$t("errorText"),onLoad:d.onLoad,direction:"up","loading-text":e.$t("loading"),"finished-text":e.$t("hasReachedTop")},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("ul",{class:"chat-content",onClick:t[2]||(t[2]=Object(n["withModifiers"])((function(e){return r.showMore=!1}),["stop"]))},[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(r.chatGroupHistoryMsg,(function(e,t){return Object(n["openBlock"])(),Object(n["createBlock"])(ge,{key:e.id,source:e,index:t,listLoading:r.loading,loading:!!r.sendLoading[null===e||void 0===e?void 0:e.id],error:!!r.sendError[null===e||void 0===e?void 0:e.id],showDate:d.isShowDate(e,t),onOnRemove:function(e){return d.handleRemove(t)},onOnRemoveUser:d.handleRemoveUser,onOnReply:d.handleReply,onOnReSend:d.reSendMessage,onOnRefreshPin:r.getPinMsgLoading,onOnLogin:d.login,onOnModifyChatGroupHistoryMsg:d.onModifyChatGroupHistoryMsg},null,8,["source","index","listLoading","loading","error","showDate","onOnRemove","onOnRemoveUser","onOnReply","onOnReSend","onOnRefreshPin","onOnLogin","onOnModifyChatGroupHistoryMsg"])})),128)),m])]})),_:1},8,["loading","finished","error","error-text","onLoad","loading-text","finished-text"]),Object(n["createElementVNode"])("div",f,[Object(n["withDirectives"])(Object(n["createElementVNode"])("div",b,[v,Object(n["createElementVNode"])("div",O,[Object(n["createElementVNode"])("div",j,Object(n["toDisplayString"])(e.$t("reply"))+" "+Object(n["toDisplayString"])(r.replyMsg.user_nickname||((null===(V=r.replyMsg)||void 0===V||null===(A=V.user_address)||void 0===A||null===(z=A.slice)||void 0===z?void 0:z.call(A,0,4))||"")+"..."+((null===(J=r.replyMsg)||void 0===J||null===(Y=J.user_address)||void 0===Y||null===(W=Y.slice)||void 0===W?void 0:W.call(Y,-4))||"")),1),Object(n["createElementVNode"])("div",y,[4==(null===(q=r.replyMsg)||void 0===q?void 0:q.type)?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:0},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.$t("image")),1)],64)):Object(n["createCommentVNode"])("",!0),7==(null===(K=r.replyMsg)||void 0===K?void 0:K.type)?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:1},[Object(n["createTextVNode"])(" 【"+Object(n["toDisplayString"])(e.$t("dappLink"))+"】"+Object(n["toDisplayString"])(null===(Q=r.replyMsg)||void 0===Q||null===(X=Q.content)||void 0===X?void 0:X.name),1)],64)):(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:2},[Object(n["createTextVNode"])(Object(n["toDisplayString"])((null===(Z=r.replyMsg)||void 0===Z?void 0:Z.content)||""),1)],64))])]),Object(n["createVNode"])(me,{name:"cross",size:"0.44rem",color:"#3F80F7",onClick:t[5]||(t[5]=Object(n["withModifiers"])((function(e){return r.replyMsg={}}),["stop"]))})],512),[[n["vShow"],r.replyMsg.id]]),Object(n["createElementVNode"])("div",k,[2===d.groupInfo.status&&d.role<1&&d.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",M,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.$t("violationBan")),1)])):5===(null===(ee=e.$store.state.chat)||void 0===ee?void 0:ee.userInfo.status)&&d.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.$t("kickOutAllGroup")),1)])):5===d.groupMemberInfo.status&&d.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",C,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.$t("kickOutGroup")),1)])):2===d.groupMemberInfo.status&&d.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.$t("permanentBanRecommend")),1)])):1===d.groupMemberInfo.status&&d.chatToken&&Date.now()<1e3*d.groupMemberInfo.banned_expired_time?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",w,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.$t("banned"))+Object(n["toDisplayString"])(e.$f.formatDate(d.groupMemberInfo.banned_expired_time))+" "+Object(n["toDisplayString"])(e.$t("unban1")),1)])):d.chatToken&&null!==(te=d.groupMemberInfo)&&void 0!==te&&te.group_id&&1!==(null===(oe=d.groupMemberInfo)||void 0===oe?void 0:oe.is_leave)?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",I,[Object(n["createVNode"])(fe,{ref:"inputMessage",class:"chat-bottom-input",style:{height:"auto"},modelValue:r.message,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.message=e}),modelModifiers:{trim:!0},rows:"1",autosize:"",maxlength:"300",label:"",type:"textarea",clearable:"",placeholder:e.$t("enterMessage")+d.priceMsg,onFocus:t[7]||(t[7]=function(e){return le.showMore=!1})},null,8,["modelValue","placeholder"]),r.message?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("i",{key:0,class:"iconfont icon-jiahao",onClick:t[8]||(t[8]=function(e){return le.showMore=!le.showMore}),style:{"font-size":"32px",color:"#DCDCDC"}}))])):null!==(ne=e.$store.state)&&void 0!==ne&&null!==(ie=ne.chat)&&void 0!==ie&&null!==(se=ie.groupMemberInfo)&&void 0!==se&&se.group_id&&1!==(null===(re=e.$store.state)||void 0===re||null===(ce=re.chat)||void 0===ce||null===(ae=ce.groupMemberInfo)||void 0===ae?void 0:ae.is_leave)||!d.chatToken?(Object(n["openBlock"])(),Object(n["createBlock"])(fe,{key:7,class:"chat-bottom-input readonly",modelValue:r.message,"onUpdate:modelValue":t[9]||(t[9]=function(e){return r.message=e}),rows:"1",autosize:"",label:"",type:"textarea",clearable:"",readonly:"",placeholder:e.$t("pleaseLoginToSendMessagesInGroup"),onClick:Object(n["withModifiers"])(d.login,["stop"])},null,8,["modelValue","placeholder","onClick"])):(Object(n["openBlock"])(),Object(n["createBlock"])(be,{key:6,round:"",plain:"",block:"",type:"primary",size:"small",style:{height:"0.68rem"},onClick:Object(n["withModifiers"])(d.joinChatGroup,["stop"]),loading:r.joinLoading,disabled:e.$store.state.chat.initChatLoading},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.$t("joinGroupChat")),1)]})),_:1},8,["onClick","loading","disabled"])),3===d.groupInfo.status&&!r.isFinish&&d.role<1&&""!==d.role?(Object(n["openBlock"])(),Object(n["createBlock"])(ve,{key:8,class:"count-down",onFinish:t[10]||(t[10]=function(e){return r.isFinish=!0}),ref:"countDown",time:r.time,format:"mm:ss"},null,8,["time"])):Object(n["createCommentVNode"])("",!0),Object(n["withDirectives"])((Object(n["openBlock"])(),Object(n["createElementBlock"])("svg",{class:"icon-svg icon-send","aria-hidden":"true",onClick:t[11]||(t[11]=Object(n["withModifiers"])((function(){return d.sendChatMsg&&d.sendChatMsg.apply(d,arguments)}),["stop"]))},N,512)),[[n["vShow"],(3===d.groupInfo.status&&(r.isFinish||d.role>=1)||3!==d.groupInfo.status)&&r.message.trim()]])]),Object(n["createVNode"])(n["Transition"],null,{default:Object(n["withCtx"])((function(){var o,i;return[r.showMore&&d.chatToken&&null!==(o=d.groupMemberInfo)&&void 0!==o&&o.group_id&&1!==(null===(i=d.groupMemberInfo)||void 0===i?void 0:i.is_leave)?(Object(n["openBlock"])(),Object(n["createBlock"])(je,{key:0,gutter:20,class:"more-features"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(Oe,{span:"6"},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",T,[Object(n["createElementVNode"])("label",{onClick:t[12]||(t[12]=function(){return d.create&&d.create.apply(d,arguments)})},[E,Object(n["createElementVNode"])("span",B,Object(n["toDisplayString"])(e.$t("redPacket")),1)])])]})),_:1}),Object(n["createVNode"])(Oe,{span:"6"},{default:Object(n["withCtx"])((function(){return[d.role>=1?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",S,[Object(n["createElementVNode"])("label",x,[L,Object(n["createElementVNode"])("span",G,Object(n["toDisplayString"])(e.$t("camera")),1)]),Object(n["createElementVNode"])("input",{type:"file",ref:"fileLogo",id:"uploaderFile-1",accept:"image/png, image/jpeg, image/gif, image/jpg",onChange:t[13]||(t[13]=function(){return d.beforeUpload&&d.beforeUpload.apply(d,arguments)})},null,544)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",D,[Object(n["createElementVNode"])("label",{onClick:t[14]||(t[14]=function(t){return e.$toast(le.$t("imageAuth"))})},[H,Object(n["createElementVNode"])("span",P,Object(n["toDisplayString"])(e.$t("camera")),1)])]))]})),_:1})]})),_:1})):Object(n["createCommentVNode"])("",!0)]})),_:1}),Object(n["createVNode"])(ke,{show:r.dialogImage,"onUpdate:show":t[15]||(t[15]=function(e){return r.dialogImage=e}),title:e.$t("tips"),"show-cancel-button":"","cancel-button-text":e.$t("cancel"),"show-confirm-button":"","confirm-button-text":e.$t("confirm"),onConfirm:d.sendWithPic,onCancel:d.cancelWithPic,"lock-scroll":""},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",F,[Object(n["createVNode"])(ue,{width:"100",fit:"cover","lazy-load":"",src:r.fileUrl},{loading:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(ye,{type:"spinner",size:"100"})]})),error:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(me,{name:"close",size:"100"})]})),_:1},8,["src"])])]})),_:1},8,["show","title","cancel-button-text","confirm-button-text","onConfirm","onCancel"])]),d.unreceivedredpacketList.length>0?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"red-notion",onClick:t[16]||(t[16]=Object(n["withModifiers"])((function(){return d.goAnchor&&d.goAnchor.apply(d,arguments)}),["stop","prevent"]))},[Object(n["createVNode"])(Me,{content:d.unreceivedredpacketList.length,max:"99"},{default:Object(n["withCtx"])((function(){return[R]})),_:1},8,["content"])])):Object(n["createCommentVNode"])("",!0)]),d.role>1&&2!==d.groupInfo.status&&3!==d.groupInfo.status?(Object(n["openBlock"])(),Object(n["createBlock"])($e,{key:0,class:"punish-btn",to:{name:"ChatPenalty",params:{id:d.groupId}}},{default:Object(n["withCtx"])((function(){return[U]})),_:1},8,["to"])):Object(n["createCommentVNode"])("",!0)],64)}var z=o("1da1"),J=o("53ca"),Y=o("2909"),W=o("5530"),q=(o("96cf"),o("ac1f"),o("00b4"),o("caad"),o("2532"),o("4de4"),o("d3b7"),o("c740"),o("a434"),o("d81d"),o("99af"),o("5319"),o("e9c4"),o("3ca3"),o("ddb0"),o("2b3d"),o("9861"),o("159b"),o("b64b"),o("365c")),K=function(e){return Object(n["pushScopeId"])("data-v-17ca1e62"),e=e(),Object(n["popScopeId"])(),e},Q=K((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-notice"},null,-1)})),X={class:"chat-notice-content"},Z={class:"content van-ellipsis"},ee={key:1,class:"notice-placeholder"},te={class:"notice-content"};function oe(e,t,o,i,s,r){var c=Object(n["resolveComponent"])("van-icon"),a=Object(n["resolveComponent"])("van-dialog");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[s.noticeVisible?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"chat-notice",onClick:t[1]||(t[1]=Object(n["withModifiers"])((function(){return r.goTopList&&r.goTopList.apply(r,arguments)}),["stop"]))},[Q,Object(n["createElementVNode"])("div",X,[Object(n["createElementVNode"])("div",Z,Object(n["toDisplayString"])(o.content||e.$t("chatPrincipleContent")),1)]),Object(n["createVNode"])(c,{class:"icon-close",name:"cross",size:"0.44rem",color:"#C8C9CC",onClick:t[0]||(t[0]=Object(n["withModifiers"])((function(e){return s.noticeVisible=!1}),["stop"]))})])):Object(n["createCommentVNode"])("",!0),s.noticeVisible?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ee)):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(a,{show:s.show,"onUpdate:show":t[3]||(t[3]=function(e){return s.show=e}),showConfirmButton:"",confirmButtonColor:"#3F80F7"},{title:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.$t("chatConvention"))+" ",1),Object(n["createVNode"])(c,{class:"icon-dialog-close",name:"close",color:"#C8C9CC",size:"0.44rem",onClick:t[2]||(t[2]=Object(n["withModifiers"])((function(e){return s.show=!1}),["stop"]))})]})),default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",te,Object(n["toDisplayString"])(e.$t("chatPrincipleContent")),1)]})),_:1},8,["show"])],64)}var ne={name:"ChatNotice",props:{content:{type:String,default:""}},data:function(){return{noticeVisible:!0,show:!1,notice:""}},methods:{goTopList:function(){this.content?this.$router.push({name:"ChatTop",params:{id:this.$route.params.id}}):this.show=!0}}},ie=(o("a5b8"),o("6b0d")),se=o.n(ie);const re=se()(ne,[["render",oe],["__scopeId","data-v-17ca1e62"]]);var ce=re,ae=o("fa7d"),le=o("335a"),ue=o("37b2"),de=o("de8e"),he=o("c9d9"),ge={name:"Chat",components:{ChatNotice:ce,ChatItem:de["a"]},setup:function(){function e(){Object(n["nextTick"])((function(){setTimeout((function(){var e,t=document.querySelector(".scroll-bottom");null===t||void 0===t||null===(e=t.scrollIntoView)||void 0===e||e.call(t,!0)}),10)}))}var t=window.navigator.userAgent.toLocaleLowerCase(),o=/iphone|ipad|ipod/.test(t),i=/android/.test(t);i?Object(ue["a"])("resize",e):o&&Object(ue["a"])("focusout",e,{target:document.body})},data:function(){return{message:"",isLogin:""!==this.$store.state.currentAccount||!1,noticeVisible:!0,chatGroupHistoryMsg:[],count:7,loading:!1,finished:!1,error:!1,scrollChatId:"",joinLoading:!1,user:{ave_points:0,jf:0},showPopover:{},timer:null,time:3e4,isFinish:!0,isTip:le["a"].get("grabAdmin",[]).includes(this.$store.state.chat.groupId)||!1,isInit:!0,sendLoading:{},sendError:{},sendMessageLoading:!1,timerMsg:null,msgCaches:[],TimerSaveMsgTime:null,replyMsg:{},activePinMsg:{},getPinMsgLoading:!1,fromPath:"",showMore:!1,dialogImage:!1,profilePicture:{},fileUrl:"",step:1e3,unreceivedClickCount:0}},computed:{chatToken:function(){var e,t;return(null===(e=this.$store.state)||void 0===e||null===(t=e.chat)||void 0===t?void 0:t.chatToken)||""},groupInfo:function(){var e,t;return(null===(e=this.$store.state)||void 0===e||null===(t=e.chat)||void 0===t?void 0:t.groupInfo)||{id:"",name:"",nickname:""}},groupMemberInfo:function(){var e,t;return(null===(e=this.$store.state)||void 0===e||null===(t=e.chat)||void 0===t?void 0:t.groupMemberInfo)||{}},memberCount:function(){var e,t;return null===(e=this.$store.state)||void 0===e||null===(t=e.chat)||void 0===t?void 0:t.memberCount},online:function(){var e;return(null===(e=this.groupInfo)||void 0===e?void 0:e.online_members)||0},total:function(){var e;return(null===(e=this.groupInfo)||void 0===e?void 0:e.total_members)||0},startId:function(){var e,t;return(null===(e=this.chatGroupHistoryMsg)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.id)||"-1"},role:function(){if(""===this.$store.state.chat.groupMemberInfo.role||""===this.$store.state.chat.groupMemberInfo.user_role)return"";var e=2===this.$store.state.chat.groupMemberInfo.role?1.5:this.$store.state.chat.groupMemberInfo.role,t=Math.max(e,this.$store.state.chat.groupMemberInfo.user_role);return t},groupId:function(){return this.$store.state.chat.groupId},price:function(){return this.$store.state.chat.price||0},priceChange:function(){return this.$store.state.chat.priceChange||0},priceMsg:function(){if(!this.price||!this.priceChange)return"";var e=this.priceChange>0?"+".concat(this.priceChange,"%"):"".concat(this.priceChange,"%");return"  |  $"+this.$f.formatNumber2(this.price)+"  "+e},unreceivedredpacketList:function(){return this.$store.state.chat.unreceivedredpacketList||[]}},watch:{"$store.state.ws.chatMsg":function(e){var t,o=this;if(e.group_id===this.$store.state.chat.groupId)if("groupmember_control"!==e.action&&"user_control"!==e.action){if("group_member_status"===e.action)return this.$store.state.chat.memberCount.online_members=e.online,this.$store.state.chat.memberCount.total_members=e.total,this.$store.state.chat.groupInfo.online_members=e.online,void(this.$store.state.chat.groupInfo.total_members=e.total);if("price"===e.action)return this.$store.state.chat.price=e.price,void(this.$store.state.chat.priceChange=e.price_change);if("delete_msg"===e.action){var n=this.chatGroupHistoryMsg.findIndex((function(t){return t.id===e.id}));return n>-1&&(this.chatGroupHistoryMsg.splice(n,1),this.getPinMsg()),void(e.online&&(this.$store.state.chat.memberCount.online_members=e.online,this.$store.state.chat.groupInfo.online_members=e.online))}if("group_control"!==e.action){if("pin_msg"!==e.action){if("unpin_msg"===e.action){var i=this.chatGroupHistoryMsg.findIndex((function(t){return t.id===e.id}));return i>-1&&(this.chatGroupHistoryMsg[i].is_pined=0),void this.getPinMsg()}if(e.online&&(this.$store.state.chat.memberCount.online_members=e.online,this.$store.state.chat.groupInfo.online_members=e.online),(null===(t=this.chatGroupHistoryMsg)||void 0===t?void 0:t.length)>0){var s,r=null===(s=this.$store.state.chat)||void 0===s?void 0:s.userInfo;if(r.address===e.user_address&&r.chain===e.user_chain&&this.sendMessageLoading)return;var c=this.chatGroupHistoryMsg.findIndex((function(t){return t.id===e.id}));if(c>-1)this.chatGroupHistoryMsg.splice(c,1,Object(W["a"])(Object(W["a"])({},e),{},{image:e.user_image,nickname:e.user_nickname,to_msg:e.to_msg?JSON.parse(e.to_msg):""}));else{var a=this.chatGroupHistoryMsg[this.chatGroupHistoryMsg.length-1];if((null===e||void 0===e?void 0:e.created_time)>(null===a||void 0===a?void 0:a.created_time)){var l=Object(W["a"])(Object(W["a"])({},e),{},{image:e.user_image,nickname:e.user_nickname,to_msg:e.to_msg?JSON.parse(e.to_msg):""});this.msgCaches.push(l),this.timerMsg||(this.timerMsg=setTimeout((function(){var e;(e=o.chatGroupHistoryMsg).push.apply(e,Object(Y["a"])(o.msgCaches)),o.msgCaches=[],o.timerMsg=null,o.scrollBottom()}),1e3)),null!==e&&void 0!==e&&e.created_time&&this.saveLastMsgTime(null===e||void 0===e?void 0:e.created_time)}}}else this.chatGroupHistoryMsg.push(e),this.scrollBottom(),null!==e&&void 0!==e&&e.created_time&&this.saveLastMsgTime(null===e||void 0===e?void 0:e.created_time)}else if(e.msg){var u=this.chatGroupHistoryMsg.findIndex((function(t){return t.id===e.id}));u>-1&&(this.chatGroupHistoryMsg[u].is_pined=1),this.getPinMsg()}}else this.$store.state.chat.groupInfo.status=e.status}else if(5===e.status){var d;this.chatGroupHistoryMsg=this.chatGroupHistoryMsg.filter((function(t){return!(t.user_address===e.user_address&&t.user_chain===e.user_chain)}));var h=null===(d=this.$store.state.chat)||void 0===d?void 0:d.userInfo;h.address===e.user_address&&h.chain===e.user_chain&&this.$store.dispatch("getChatGroupMemberInfo",this.groupId)}},"$store.state.ws.isConnected":function(e){e&&this.subChatMsg()},"$store.state.currentAccount":function(e){e&&"Chat"===this.$route.name&&e!==localStorage.currentAccount&&Object(ae["b"])(),this.$store.commit("setIsobserve","false")},"$store.state.chat.chatToken":function(e){e&&this.subChatMsg()},"$store.state.chat.groupInfo.manager_count":function(e){var t;void 0!==e&&e<5&&0===this.role&&!this.isTip&&this.chatToken&&null!==(t=this.groupMemberInfo)&&void 0!==t&&t.group_id&&this.alertTips()},role:function(e){var t=this.$store.state.chat.groupInfo.manager_count;0===e&&void 0!==t&&t<5&&!this.isTip&&this.alertTips()},"$store.state.chat.groupMemberInfo.group_id":function(){this.alertTips()},"$store.state.chat.userInfo":function(){this.initSlowMode()},groupId:function(e){e&&(this.chatGroupHistoryMsg=[],this.$store.state.chat.price=0,this.$store.state.chat.priceChange=0,this.init(),this.getPinMsg())}},beforeRouteEnter:function(e,t,o){o((function(o){var n,i;o.fromPath=t.path,null!==(n=e.query)&&void 0!==n&&n.chatToken&&o.$store.commit("setChatToken",e.query.chatToken),null!==(i=e.query)&&void 0!==i&&i.isobserve&&o.$store.commit("setIsobserve",e.query.isobserve)}))},created:function(){document.removeEventListener("visibilitychange",this.bindVisible),document.addEventListener("visibilitychange",this.bindVisible)},mounted:function(){this.subChatMsg(),this.getPinMsg(),this.loginChat(),this.$store.dispatch("getUnreceivedredpacket")},methods:{init:function(){this.isInit=!0,this.finished=!1,this.error=!1,this.loading||this.getChatGroupHistoryMsg(-1),this.subChatMsg(),this.$store.dispatch("subChatToken"),this.$store.dispatch("getUnreceivedredpacket")},bindVisible:function(){"visible"===document.visibilityState&&this.init()},getChatGroupHistoryMsg:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startId,o=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,i){e.groupId&&(e.loading=!0,e.count=o?"":7,Object(q["O"])(e.groupId,e.count,t,o).then((function(t){var o;console.log("getChatGroupHistoryMsg:",t),e.finished=t.length<e.count,t=t.map((function(e){var t,o,n,i=Object(W["a"])({},e);null!==e&&void 0!==e&&e.to_msg&&(i.to_msg=JSON.parse(e.to_msg),null!==(t=i.to_msg)&&void 0!==t&&t.content&&7==e.type&&Object(ae["f"])(null===(o=i.to_msg)||void 0===o?void 0:o.content)&&(i.to_msg.content=JSON.parse(null===(n=i.to_msg)||void 0===n?void 0:n.content)));return null!==e&&void 0!==e&&e.content&&7==e.type&&Object(ae["f"])(null===e||void 0===e?void 0:e.content)&&(i.content=JSON.parse(e.content)),i}));var i,s,r,c,a,l=0,u=0;(null!==(o=e.chatGroupHistoryMsg)&&void 0!==o&&o[0]&&(l=document.body.scrollHeight,u=document.documentElement.scrollTop||window.pageYOffset),e.isInit)?(e.chatGroupHistoryMsg=t,(null===(i=t)||void 0===i?void 0:i.length)>0&&null!==(s=t)&&void 0!==s&&null!==(r=s[t.length-1])&&void 0!==r&&r.created_time&&e.saveLastMsgTime(null===(c=t)||void 0===c||null===(a=c[t.length-1])||void 0===a?void 0:a.created_time)):e.chatGroupHistoryMsg=t.concat(e.chatGroupHistoryMsg);e.$nextTick((function(){if(e.isInit)e.isInit=!1,e.scrollBottom(!0);else{var t=document.body.scrollHeight;document.scrollingElement.scrollTop=t-l+u}})),n(e.chatGroupHistoryMsg)})).catch((function(){e.error=!0,i([])})).finally((function(){setTimeout((function(){e.loading=!1}),1e3)})))}))},onLoad:function(){this.showMore&&(this.showMore=!1),this.getChatGroupHistoryMsg()},sendChatMsg:function(){var e,t,o,n,i=this;if(null===(e=this.$refs)||void 0===e||null===(t=e.inputMessage)||void 0===t||null===(o=t.focus)||void 0===o||o.call(t),this.message){var s={group_id:this.groupId,content:this.message,to_id:this.replyMsg.id||0,type:1};this.sendMessageLoading=!0;var r=parseInt(Date.now()/1e3),c="send-".concat(r);this.sendLoading[c]=!0;var a=(null===(n=this.$store.state.chat)||void 0===n?void 0:n.userInfo)||{};this.chatGroupHistoryMsg.push({id:c,created_time:r,group_id:this.groupId,type:1,is_pined:0,content:this.message,user_image:(null===a||void 0===a?void 0:a.image)||"",nickname:(null===a||void 0===a?void 0:a.nickname)||"",user_address:(null===a||void 0===a?void 0:a.address)||"",user_chain:(null===a||void 0===a?void 0:a.chain)||"",user_role:this.groupMemberInfo.user_role||0,member_role:this.groupMemberInfo.role||0,to_msg:this.replyMsg.id?this.replyMsg:""}),this.scrollBottom(),this.message="",this.replyMsg={},this.isFinish=!1,this.time=3e4,this.$nextTick((function(){var e,t,o;null===(e=i.$refs)||void 0===e||null===(t=e.countDown)||void 0===t||null===(o=t.pause)||void 0===o||o.call(t)})),Object(q["Ec"])(s).then((function(e){var t,o,n;console.log("send message",e),i.sendLoading[c]=!1;var s=i.chatGroupHistoryMsg.findIndex((function(e){return e.id===c}));null!==e&&void 0!==e&&e.id?i.chatGroupHistoryMsg.splice(s,1,Object(W["a"])(Object(W["a"])({},e),{},{image:e.user_image,nickname:e.user_nickname,to_msg:e.to_msg?JSON.parse(e.to_msg):""})):i.chatGroupHistoryMsg.splice(s,1),i.sendMessageLoading=!1,null===(t=i.$refs)||void 0===t||null===(o=t.countDown)||void 0===o||null===(n=o.start)||void 0===n||n.call(o),i.$store.commit("chatUserSendTimeAdd",Date.now())})).catch((function(e){console.log(e),i.sendLoading[c]=!1,i.sendError[c]=!0,i.$toast({message:e,position:"top"}),i.sendMessageLoading=!1}))}},reSendMessage:function(e){var t,o,n,i=this;null===(t=this.$refs)||void 0===t||null===(o=t.inputMessage)||void 0===o||null===(n=o.focus)||void 0===n||n.call(o);var s=e.id;this.sendLoading[s]=!0,this.sendError[s]=!1;var r={group_id:this.groupId,content:e.content,to_id:this.replyMsg.id||0,type:1};this.sendMessageLoading=!0,this.isFinish=!1,this.time=3e4,this.$nextTick((function(){var e,t,o;null===(e=i.$refs)||void 0===e||null===(t=e.countDown)||void 0===t||null===(o=t.pause)||void 0===o||o.call(t)})),Object(q["Ec"])(r).then((function(e){console.log("send message",e),i.sendLoading[s]=!1;var t=i.chatGroupHistoryMsg.findIndex((function(e){return e.id===s}));null!==e&&void 0!==e&&e.id?i.chatGroupHistoryMsg.splice(t,1,Object(W["a"])(Object(W["a"])({},e),{},{image:e.user_image,nickname:e.user_nickname})):i.chatGroupHistoryMsg.splice(t,1),i.sendMessageLoading=!1,i.$refs.countDown.start(),i.$store.commit("chatUserSendTimeAdd",Date.now())})).catch((function(e){i.sendLoading[s]=!1,i.sendError[s]=!0,i.$toast({message:e,position:"top"}),i.sendMessageLoading=!1}))},scrollBottom:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.body.scrollHeight,o=document.documentElement.scrollTop||window.pageYOffset,n=window.innerHeight||document.documentElement.clientHeight,i=t-o;i>2*n&&!e||this.$nextTick((function(){setTimeout((function(){var e,t=document.querySelector(".scroll-bottom");null===t||void 0===t||null===(e=t.scrollIntoView)||void 0===e||e.call(t,!0)}),10)}))},handleRemove:function(e){this.chatGroupHistoryMsg.splice(e,1),this.$toast({message:this.$t("deletedSuccessfully"),position:"top"})},handleRemoveUser:function(e){this.$toast.success(this.$t("kickedSuccessfully")),this.chatGroupHistoryMsg=this.chatGroupHistoryMsg.filter((function(t){return!(t.user_address===e.user_address&&t.user_chain===e.user_chain)}))},login:function(){Object(ae["b"])()},loginChat:function(){var e=this;"0xe49f43b4a01edc6b1b0244a32d8383935b53887c"!==this.$store.state.currentAccount&&"0x0642bceeb3501b4aee2d3d72fb618ad9d48aeee1"!==this.$store.state.currentAccount||Object(q["mc"])({user_address:this.$store.state.currentAccount,user_chain:this.$store.getters.netId,password:"123456"}).then((function(t){t&&(e.$store.commit("setChatToken",t),"MyChat"===e.$route.name?e.$emit("login"):(e.$store.dispatch("getChatInfo"),e.$store.dispatch("getChatGroupSettings")),e.$store.commit("setLoginVisible",!1))})).catch((function(t){e.$toast({message:t,position:"top"})}))},joinChatGroup:function(){var e=this;this.joinLoading=!0,Object(q["jc"])(this.groupId).then((function(t){return t?e.$store.dispatch("getChatGroupMemberInfo",e.groupId):Promise.resolve(!1)})).then((function(t){t&&e.$toast({message:e.$t("joinGroupChatSuccessfully"),position:"top"})})).catch((function(t){e.$toast({message:t,position:"top"})})).finally((function(){e.joinLoading=!1}))},subChatMsg:function(){var e={jsonrpc:"2.0",method:"subscribe",params:["chat",this.groupId],id:1};if(this.$store.state.ws.isConnected){var t=this.$store.state.ws.chatParams;if(t[1]===e.params[1])return;(null===t||void 0===t?void 0:t.length)>0&&this.$store.commit("wsSend",{jsonrpc:"2.0",method:"unsubscribe",params:this.$store.state.ws.chatParams,id:1}),this.$store.commit("setWsState",{name:"chatParams",value:e.params}),this.$store.commit("wsSend",e)}},alertTips:function(){var e,t=this;if(!(this.$store.state.ios.platform&&this.$store.state.ios.version&&this.$f.compareVersion(this.$store.state.ios.version))){var o,n=this.$store.state.chat.groupInfo.manager_count;if(void 0!==n&&n<5&&0===this.role&&!this.isTip&&this.chatToken&&null!==(e=this.groupMemberInfo)&&void 0!==e&&e.group_id)this.isTip=!0,this.$dialog.confirm({message:this.$t("adminCountMessage",{count:5-n}),confirmButtonText:this.$t("grabbingAdmin",{n:(null===(o=this.$store.state.chat.chatConfig)||void 0===o?void 0:o.ave_chat_usdt_count)||""}),cancelButtonText:this.$t("cancel"),confirmButtonColor:"#3F80F7",teleport:"#grab-dialog"}).then((function(){t.$toast(t.$t("contactAdmin")+"business@ave.ai"),t.isTip=!1;var e=le["a"].get("grabAdmin",[]);e.push(t.$store.state.chat.groupId),le["a"].set("grabAdmin",e)})).catch((function(){t.isTip=!1;var e=le["a"].get("grabAdmin",[]);e.push(t.$store.state.chat.groupId),le["a"].set("grabAdmin",e)}))}},initSlowMode:function(){var e=this.$store.getters.userSendTime,t=Date.now()-e;this.isFinish=t>3e4,this.time=t<3e4?3e4-t:3e4},isShowDate:function(e,t){if(0===t)return!0;var o=this.$f.formatDate(e.created_time,"YYYY-MM-DD"),n=this.$f.formatDate(this.chatGroupHistoryMsg[t-1].created_time,"YYYY-MM-DD");return o!==n},back:function(){var e,t,o,n,i,s,r;if(null!==(e=window)&&void 0!==e&&null!==(t=e._tw_)&&void 0!==t&&t.back)null===(i=window)||void 0===i||null===(s=i._tw_)||void 0===s||null===(r=s.back)||void 0===r||r.call(s);else if(null!==(o=window)&&void 0!==o&&null!==(n=o.main)&&void 0!==n&&n.back){var c,a,l;null===(c=window)||void 0===c||null===(a=c.main)||void 0===a||null===(l=a.back)||void 0===l||l.call(a)}else if(window.WKWebViewJavascriptBridge)this.$f.goBack();else{var u,d;null!==(u=window.history)&&void 0!==u&&null!==(d=u.state)&&void 0!==d&&d.back?this.$f.goBack():this.$router.replace("/token/".concat(this.groupId))}},saveLastMsgTime:function(e){var t=this;"Chat"===this.$route.name&&(this.TimerSaveMsgTime&&clearTimeout(this.TimerSaveMsgTime),this.TimerSaveMsgTime=setTimeout((function(){t.$store.dispatch("setChatLastMsgTime",e)}),1e3))},handleReply:function(e){this.replyMsg=e},getPinMsg:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.groupId&&(this.getPinMsgLoading=!0,Object(q["zb"])(this.groupId,1,t).then((function(t){var o;if((null===t||void 0===t||null===(o=t.pin_msg)||void 0===o?void 0:o.length)>0){var n,i,s,r=null===t||void 0===t||null===(n=t.pin_msg)||void 0===n?void 0:n[0];if(e.activePinMsg=Object(W["a"])({},r),null!==r&&void 0!==r&&r.to_msg&&(e.activePinMsg.to_msg=JSON.parse(r.to_msg)),null!==r&&void 0!==r&&r.to_msg)if(e.activePinMsg.to_msg=JSON.parse(r.to_msg),null!==r&&void 0!==r&&null!==(i=r.to_msg)&&void 0!==i&&i.content)e.activePinMsg.to_msg.content=JSON.parse(null===(s=r.to_msg)||void 0===s?void 0:s.content);null!==r&&void 0!==r&&r.content&&7==r.type&&(e.activePinMsg.content=JSON.parse(r.content))}else e.activePinMsg={content:""}})).catch((function(e){console.log(e)})).finally((function(){e.getPinMsgLoading=!1})))},onModifyChatGroupHistoryMsg:function(e,t){this.chatGroupHistoryMsg.map((function(o){if(e==o.id){var n=JSON.parse(o.content),i=Object.assign(n,t);o=Object.assign(o,{content:JSON.stringify(i)})}}))},create:function(){var e=this;if(this.$store.state.chat.isobserve&&"true"==this.$store.state.chat.isobserve)this.$toast(this.$t("isobserve"));else if("importAddress"==this.$store.state.wallet&&""==this.$store.state.provider&&window.ethereum)this.$dialog.alert({message:this.$t("connectWalletAgain"),confirmButtonText:this.$t("iKnown"),confirmButtonColor:"#3F80F7"});else{var t=he["a"].findIndex((function(t){var o;return t==(null===(o=e.$store.state.chat)||void 0===o?void 0:o.userInfo.chain)}));-1!=t?this.$router.push({path:"/chat/".concat(this.groupId,"/redCreate"),query:{total:this.total}}):this.$toast(this.$t("tipSwitchChain",{chain:"BSC"}))}},beforeUpload:function(e){var t,o=null===(t=e.target)||void 0===t?void 0:t.files[0];if(o){if(o.size/1024/1024>1)return this.$message.error("图片大小超出限制"),!1;console.log("file",o),console.log("----",Object(J["a"])(o)),this.profilePicture=o,this.fileUrl=window.URL.createObjectURL(o),this.fileUrl&&this.profilePicture&&(this.dialogImage=!0,e.target.value="")}},sendWithPic:function(){var e=this,t=this.$toast.loading({message:"loading...",forbidClick:!0,duration:0}),o={group_id:this.$store.state.chat.groupId,content:"image",type:4,to_id:this.replyMsg.id||0,profile_picture:this.profilePicture},n=new FormData,i=Object(W["a"])({},o);Object.keys(i).forEach((function(e){var t,o=null!==(t=i[e])&&void 0!==t?t:"";"profile_picture"===e&&""!==o?n.append("profile_picture",o,"".concat(i.group_id,".png")):""!==o&&n.append(e,o)})),Object(q["Gc"])(n).then((function(e){})).catch((function(t){console.log(t),e.$notify({type:"danger",message:e.$t("fail")})})).finally((function(){e.showMore=!1,e.replyMsg={},t.clear()}))},cancelWithPic:function(){this.profilePicture={},this.fileUrl="",this.dialogImage=!1},goAnchor:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.unreceivedClickCount>=e.unreceivedredpacketList.length&&(e.unreceivedClickCount=0),o=e.unreceivedredpacketList[e.unreceivedClickCount].id,t.next=4,e.getChatGroupHistoryMsg(e.startId,o);case 4:setTimeout((function(){var e;null===(e=document.getElementById(o))||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})}),500),e.unreceivedClickCount++;case 6:case"end":return t.stop()}}),t)})))()}}};o("899d");const pe=se()(ge,[["render",A],["__scopeId","data-v-08d40136"]]);t["default"]=pe},"899d":function(e,t,o){"use strict";o("8d98")},"8d98":function(e,t,o){},a5b8:function(e,t,o){"use strict";o("fba5")},fba5:function(e,t,o){}}]);