(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ChatTop"],{"2c17":function(t,e,o){},deef:function(t,e,o){"use strict";o.r(e);var n=o("7a23"),i=function(t){return Object(n["pushScopeId"])("data-v-17dc1189"),t=t(),Object(n["popScopeId"])(),t},s={class:"top-container"},r={class:"chat-container"},c={class:"chat-content"},a=i((function(){return Object(n["createElementVNode"])("li",{class:"scroll-bottom"},null,-1)}));function l(t,e,o,i,l,d){var u=Object(n["resolveComponent"])("van-nav-bar"),f=Object(n["resolveComponent"])("ChatItem"),h=Object(n["resolveComponent"])("van-list");return Object(n["openBlock"])(),Object(n["createElementBlock"])("section",s,[Object(n["createVNode"])(u,{"left-text":"","left-arrow":"",onClickLeft:e[0]||(e[0]=function(e){return t.$f.goBack()}),fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2"},{title:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.$t("topMessages"))+"("+Object(n["toDisplayString"])(l.total)+") ",1)]})),_:1}),Object(n["createElementVNode"])("ul",r,[Object(n["createVNode"])(h,{loading:l.loading,"onUpdate:loading":e[1]||(e[1]=function(t){return l.loading=t}),finished:l.finished,error:l.error,"onUpdate:error":e[2]||(e[2]=function(t){return l.error=t}),offset:"200","error-text":t.$t("errorText"),onLoad:d.onLoad,direction:"up","loading-text":t.$t("loading"),"finished-text":t.$t("hasReachedTop")},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("ul",c,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.topMessages,(function(t,e){return Object(n["openBlock"])(),Object(n["createBlock"])(f,{key:t.id,source:t,index:e,showDate:d.isShowDate(t,e),isTop:"",onOnUnpin:function(t){return d.handleUnpin(e,t)}},null,8,["source","index","showDate","onOnUnpin"])})),128)),a])]})),_:1},8,["loading","finished","error","error-text","onLoad","loading-text","finished-text"])])])}var d=o("5530"),u=(o("c740"),o("a434"),o("d3b7"),o("d81d"),o("99af"),o("de8e")),f=o("365c"),h={name:"ChatTop",components:{ChatItem:u["a"]},data:function(){return{total:0,topMessages:[],count:7,loading:!1,finished:!1,error:!1}},computed:{startId:function(){var t,e;return(null===(t=this.topMessages)||void 0===t||null===(e=t[0])||void 0===e?void 0:e.id)||-1},role:function(){if(""===this.$store.state.chat.groupMemberInfo.role||""===this.$store.state.chat.groupMemberInfo.user_role)return"";var t=2===this.$store.state.chat.groupMemberInfo.role?1.5:this.$store.state.chat.groupMemberInfo.role,e=Math.max(t,this.$store.state.chat.groupMemberInfo.user_role);return e},groupId:function(){return this.$store.state.chat.groupId}},watch:{"$store.state.ws.chatMsg":function(t){if(t.group_id===this.$store.state.chat.groupId)if("delete_msg"!==t.action){if("pin_msg"!==t.action)if("unpin_msg"!==t.action);else{var e=this.topMessages.findIndex((function(e){return e.id===t.id}));e>-1&&(this.topMessages[e].is_pined=0)}else if(t.msg){var o=JSON.parse(null===t||void 0===t?void 0:t.msg);this.topMessages.push(o)}}else{var n=this.topMessages.findIndex((function(e){return e.id===t.id}));n>-1&&this.topMessages.splice(n,1)}}},activated:function(){this.init()},methods:{init:function(){this.isInit=!0,this.finished=!1,this.error=!1,this.loading||this.getPinMsg(-1)},isShowDate:function(t,e){if(0===e)return!0;var o=this.$f.formatDate(t.created_time,"YYYY-MM-DD"),n=this.$f.formatDate(this.topMessages[e-1].created_time,"YYYY-MM-DD");return o!==n},getPinMsg:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startId;this.groupId&&(this.loading=!0,Object(f["zb"])(this.groupId,this.count,e).then((function(e){var o,n,i,s,r,c,a;t.finished=(null===(o=e)||void 0===o||null===(n=o.pin_msg)||void 0===n?void 0:n.length)<t.count,t.total=(null===(i=e)||void 0===i?void 0:i.total_msg)||0,e=null===(s=e)||void 0===s||null===(r=s.pin_msg)||void 0===r||null===(c=r.map)||void 0===c?void 0:c.call(r,(function(t){var e=Object(d["a"])({},t);return null!==t&&void 0!==t&&t.to_msg&&(e.to_msg=JSON.parse(t.to_msg)),e}));var l=0,u=0;null!==(a=t.topMessages)&&void 0!==a&&a[0]&&(l=document.body.scrollHeight,u=document.documentElement.scrollTop||window.pageYOffset),t.isInit?t.topMessages=e:t.topMessages=e.concat(t.topMessages),t.$nextTick((function(){if(t.isInit)t.isInit=!1,t.scrollBottom(!0);else{var e=document.body.scrollHeight;document.scrollingElement.scrollTop=e-l+u}}))})).catch((function(){t.error=!0})).finally((function(){setTimeout((function(){t.loading=!1}),1e3)})))},handleUnpin:function(t){this.topMessages.splice(t,1),this.total--},onLoad:function(){this.getPinMsg()},scrollBottom:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=document.body.scrollHeight,o=document.documentElement.scrollTop||window.pageYOffset,n=window.innerHeight||document.documentElement.clientHeight,i=e-o;i>2*n&&!t||this.$nextTick((function(){setTimeout((function(){var t,e=document.querySelector(".scroll-bottom");null===e||void 0===e||null===(t=e.scrollIntoView)||void 0===t||t.call(e,!0)}),10)}))}}},p=(o("f93e"),o("6b0d")),g=o.n(p);const m=g()(h,[["render",l],["__scopeId","data-v-17dc1189"]]);e["default"]=m},f93e:function(t,e,o){"use strict";o("2c17")}}]);