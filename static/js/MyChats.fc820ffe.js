(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["MyChats"],{"900e":function(e,t,n){},c2e6:function(e,t,n){"use strict";n.r(t);n("b0c0");var o=n("7a23"),c=function(e){return Object(o["pushScopeId"])("data-v-1025ecb2"),e=e(),Object(o["popScopeId"])(),e},a={class:"myChat-container"},i={action:"/"},r=["onClick"],s={class:"center"},l={key:0,class:"icon-svg icon-renzheng","aria-hidden":"true"},d=c((function(){return Object(o["createElementVNode"])("use",{"xlink:href":"#icon-renzheng"},null,-1)})),u=[d],h={class:"center-bottom"},m={key:0,class:"un-receive"},f={class:"right"},b={key:0},p={key:1,class:"tag"};function g(e,t,c,d,g,j){var O=Object(o["resolveComponent"])("van-nav-bar"),v=Object(o["resolveComponent"])("van-search"),k=Object(o["resolveComponent"])("van-sticky"),y=Object(o["resolveComponent"])("van-image"),C=Object(o["resolveComponent"])("van-button"),$=Object(o["resolveComponent"])("van-swipe-cell"),w=Object(o["resolveComponent"])("van-empty"),N=Object(o["resolveComponent"])("van-list");return Object(o["openBlock"])(),Object(o["createElementBlock"])("section",a,[Object(o["createVNode"])(O,{"left-text":"","left-arrow":"",onClickLeft:j.back,fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2",title:e.$t("myChats")},null,8,["onClickLeft","title"]),Object(o["createVNode"])(k,{"offset-top":"1rem"},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("form",i,[Object(o["createVNode"])(v,{modelValue:g.keyword,"onUpdate:modelValue":t[0]||(t[0]=function(e){return g.keyword=e}),modelModifiers:{trim:!0},background:"#fff",shape:"round",placeholder:e.$t("search1"),onSearch:j.onSearch},null,8,["modelValue","placeholder","onSearch"])])]})),_:1}),Object(o["createElementVNode"])("ul",null,[Object(o["createVNode"])(N,{loading:g.loading,"onUpdate:loading":t[1]||(t[1]=function(e){return g.loading=e}),finished:g.finished,error:g.error,"onUpdate:error":t[2]||(t[2]=function(e){return g.error=e}),"error-text":e.$t("errorText"),onLoad:j.getMyChats,"loading-text":e.$t("loading"),"finished-text":e.$t("noMore"),"immediate-check":!1},{default:Object(o["withCtx"])((function(){return[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(g.chats,(function(t,c){return Object(o["openBlock"])(),Object(o["createBlock"])($,{key:c},{right:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(C,{square:"",type:"danger",text:e.$t("exitChat"),onClick:Object(o["withModifiers"])((function(e){return j.leaveChatGroup(t)}),["stop"])},null,8,["text","onClick"])]})),default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("li",{class:"li-item",onClick:Object(o["withModifiers"])((function(e){return j.goChat(t)}),["stop"])},[Object(o["createVNode"])(y,{round:"",width:"0.96rem",height:"0.96rem","icon-size":"0.96rem","lazy-load":"","show-loading":"",src:(null===t||void 0===t?void 0:t.image)||e.$f.formatIcon(t.id),"error-icon":n("aecc")},null,8,["src","error-icon"]),Object(o["createElementVNode"])("div",s,[Object(o["createElementVNode"])("div",null,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(t.nickname||t.name)+" ",1),null!==t&&void 0!==t&&t.provider_count&&(null===t||void 0===t?void 0:t.provider_count)>0?(Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",l,u)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",h,Object(o["toDisplayString"])(t.total_members)+" "+Object(o["toDisplayString"])(e.$t("members")),1)]),t.UnReceivedRedPacket_count>0?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",m,Object(o["toDisplayString"])(e.$t("unReceivedRedPacket",{n:t.UnReceivedRedPacket_count})),1)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("div",f,[t.lastchated?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",b,Object(o["toDisplayString"])(j.formatCalendar(t.lastchated)),1)):Object(o["createCommentVNode"])("",!0),(null===t||void 0===t?void 0:t.unreadmsg_count)>0?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",p,Object(o["toDisplayString"])(t.unreadmsg_count>99?"99+":t.unreadmsg_count),1)):Object(o["createCommentVNode"])("",!0)])],8,r)]})),_:2},1024)})),128)),Object(o["withDirectives"])(Object(o["createVNode"])(w,{class:"empty",image:e.emptyNoDataLight,description:e.$t("emptyData")},null,8,["image","description"]),[[o["vShow"],g.chats&&0===g.chats.length&&!g.loading]])]})),_:1},8,["loading","finished","error","error-text","onLoad","loading-text","finished-text"])])])}var j=n("1da1"),O=(n("d81d"),n("b64b"),n("d3b7"),n("99af"),n("96cf"),n("365c")),v=null,k={name:"MyChats",data:function(){return{pageNO:0,pageSize:10,keyword:"",chats:[],total:0,loading:!1,finished:!1,error:!1}},watch:{"$store.state.chat.loginVisible":function(e){!e&&this.$store.state.chat.chatToken&&this.init()},"$store.state.chat.setPasswordVisible":function(e){!e&&this.$store.state.chat.chatToken&&this.init()},keyword:function(e){var t=this;v&&clearTimeout(v),e?v=setTimeout((function(){t.init()}),1e3):this.init()}},activated:function(){this.init1()},methods:{init1:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("getChatUserInfo");case 2:e.init();case 3:case"end":return t.stop()}}),t)})))()},init:function(){this.pageNO=0,this.finished=!1,this.error=!1,this.getMyChats()},getMyChats:function(){var e=this;this.loading=!0;var t=this.$store.state.currentAccount,n=this.$store.getters.netId,o="";t&&n&&(o=t+"-"+n);var c=[],a=this.$store.state.chat.chatLastMsgTimeObj[o];o&&a&&(c=Object.keys(a).map((function(e){return{groupId:e,time:a[e]}}))),Object(O["kb"])(this.pageNO,this.pageSize,this.keyword,c).then((function(t){console.log("getMyChats",t),0===e.pageNO&&(e.chats=[]),e.total=t.total,e.chats=e.chats.concat(t.groups),e.chats.length>=e.total||t.groups.length<e.pageSize?e.finished=!0:e.pageNO++})).catch((function(){e.error=!0})).finally((function(){setTimeout((function(){e.loading=!1}),1e3)}))},onSearch:function(){v&&clearTimeout(v),this.init()},goChat:function(e){this.$router.push({name:"Chat",params:{id:e.id}})},leaveChatGroup:function(e){var t=this;this.$dialog.confirm({message:this.$t("confirmLeaveChat"),allowHtml:!1,messageAlign:"center",closeOnPopstate:!0,confirmButtonText:this.$t("confirm"),confirmButtonColor:"#3F80F7",cancelButtonText:this.$t("cancel")}).then((function(){var n=t.$toast.loading({forbidClick:!0,duration:0});Object(O["kc"])(e.id).then((function(e){n.clear(),t.init()})).catch((function(e){t.$toast({message:e,position:"top"})}))})).catch((function(){t.$store.state.chat.checkAuthVisible=!1}))},formatCalendar:function(e){var t=this.$dayjs(1e3*e).isToday();if(t)return this.$dayjs(1e3*e).format("HH:mm");var n=this.$dayjs(1e3*e).isYesterday();if(n)return this.$t("yesterday")+" "+this.$dayjs(1e3*e).format("HH:mm");var o=(new Date).getFullYear()===new Date(1e3*e).getFullYear();return o?this.$dayjs(1e3*e).format("MM-DD HH:mm"):this.$dayjs(1e3*e).format("YYYY-MM-DD HH:mm")},back:function(){var e,t,n;null!==(e=this.$f.androidGlobal())&&void 0!==e&&e.back?null===(t=this.$f.androidGlobal())||void 0===t||null===(n=t.back)||void 0===n||n.call(t):this.$f.goBack()}}},y=(n("e521"),n("6b0d")),C=n.n(y);const $=C()(k,[["render",g],["__scopeId","data-v-1025ecb2"]]);t["default"]=$},e521:function(e,t,n){"use strict";n("900e")}}]);